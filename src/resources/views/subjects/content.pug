extends ../layouts/admin
block content
    section.subject__content
        .col-lg-12.grid-margin.stretch-card
            .card
                .card-body
                    .card-title Nội dung môn học - #{subject.name} #{subject.gradeID}
                    .d-flex.align-items-center.justify-content-between
                        .form-group.mb-0.text-dark
                            span #{units.length} chương - #{lessions.length} bài học
                        a.btn.btn-outline-warning.btn-icon-text(href='/subjects/list') 
                            i.mdi.mdi-reload.btn-icon-prepend
                            | Quay lại
                    .mt-4
                        each unit in units
                            div
                                - var count = 0;
                                    each lession in lessions
                                        if (lession.unitID == unit.id)
                                            - count++;
                                    p.text-dark.font-weight-bold= unit.name
                                        span.ml-2.font-weight-normal (#{count} bài học)
                                div.ml-4.text-dark
                                    each lession in lessions
                                        if lession.unitID == unit.id
                                            p Bài #{lession.lessionNumber}. #{lession.name}
                                p.ml-4
                                    a(href='javascript:void(0)' data-toggle="modal" data-target="#addLessionModal" data-id=unit._id)
                                        i.mdi.mdi-auto-upload
                                        span.ml-2 Thêm mới bài học
                        #addLessionModal.modal.fade(tabindex='-1', role='dialog', aria-labelledby='addLessionModalLabel', aria-hidden='true')
                            .modal-dialog(role='document', style='transition: all 0.3s ease; max-width: 800px')
                                .modal-content
                                    .modal-header
                                        strong#addLessionModalLabel.modal-title.font-weight-bold.text-danger.text-uppercase Thêm mới môn học
                                        button.close(type='button', data-dismiss='modal', aria-label='Close')
                                        span(aria-hidden='true') &times;
                                    .modal-body.text-dark
                                        p.card-description Nhập thông tin bên dưới để thêm mới 1 bài học
                                        .mt-4
                                            .form-group.row
                                                label.col-sm-3.col-form-label.text-dark(for='name') Tên bài học
                                                .col-sm-9
                                                    input#name.form-control(type='text', placeholder='Nhập tên bài học', name='name', required)
                                            .form-group.row
                                                label.col-sm-3.col-form-label.text-dark(for='lessionNumber') Bài học số
                                                .col-sm-9
                                                    input#lessionNumber.form-control(type='number', placeholder='Chọn bài học số', name='lessionNumber', required)
                                            .float-right
                                                button.btn.btn-secondary(type='button', data-dismiss='modal') Hủy bỏ
                                                button.btn.btn-primary.ml-2#btn-add-lession(type='submit') Lưu lại
    script.
        document.addEventListener('DOMContentLoaded', function() {
            var addLessionModal = $("#addLessionModal");
            var unitId;
            var btnAddLession = $("#btn-add-lession");

            addLessionModal.on('show.bs.modal', function (event) {
                var button = $(event.relatedTarget);
                unitId = button.data('id');
            });

            btnAddLession.click(function () {
                var nameLession = $("input[name=name]").val();
                var numberLession = $("input[name=lessionNumber]").val();
                $.ajax({
                    method: 'POST',
                    url: '/lessions/create',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        nameLession: nameLession, 
                        numberLession: numberLession, 
                        unitId: unitId,
                    }),
                });
            });
        });