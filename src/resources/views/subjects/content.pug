extends ../layouts/admin
block content
    section.subject__content
        .col-lg-12.grid-margin.stretch-card
            .card
                .card-body
                    .card-title Nội dung môn học - #{subject.name} #{subject.gradeID}
                    .d-flex.align-items-center.justify-content-between
                        .form-group.mb-0.text-dark
                            span #{units.length} chương - #{lessions.length} bài học
                        a.btn.btn-outline-warning.btn-icon-text(href='/subjects/list') 
                            i.mdi.mdi-reload.btn-icon-prepend
                            | Quay lại
                    .mt-4
                        each unit in units
                            div
                                - var count = 0;
                                    each lession in lessions
                                        if (lession.unitID == unit.id)
                                            - count++;
                                    p.text-dark.font-weight-bold= unit.name
                                        span.ml-2.font-weight-normal (#{count} bài học)
                                        a(href='javascript:void(0)' data-toggle="modal" data-target="#editUnitModal").ml-2.text-primary.btn-edit-unit
                                            i.mdi.mdi-lead-pencil.mr-2
                                            | Chỉnh sửa
                                div.ml-4.text-dark
                                    each lession in lessions
                                        if lession.unitID == unit.id
                                            .d-flex.align-items-center.justify-content-between.mb-2
                                                span Bài #{lession.lessionNumber}. #{lession.name}
                                                div
                                                    if lession.theory.length > 0
                                                        a.text-primary(href=`/theories/detail?lession=${lession._id}`).ml-4 
                                                            i.mdi.mdi-book-open-variant.mr-2
                                                            | Lý thuyết
                                                    if lession.exercises.length > 0
                                                        a.text-primary(href='').ml-5
                                                            i.mdi.mdi-book-open-page-variant.mr-2
                                                            | Bài tập vận dụng
                                p.ml-4
                                    a.text-primary(href='javascript:void(0)' data-toggle="modal" data-target="#addLessionModal" data-id=unit._id data-name=unit.name)
                                        i.mdi.mdi-auto-upload
                                        span.ml-2 Thêm mới bài học
                        p
                            a.text-primary(href='javascript:void(0)' data-toggle="modal" data-target="#addUnitModal" data-id=subject._id)
                                i.mdi.mdi-auto-upload
                                span.ml-2 Thêm mới chuyên đề
                        
                        #editUnitModal.modal.fade(tabindex='-1', role='dialog', aria-labelledby='editUnitModalLabel', aria-hidden='true')
                            .modal-dialog(role='document', style='transition: all 0.3s ease; max-width: 800px')
                                .modal-content
                                    .modal-header
                                        strong#editUnitModalLabel.modal-title.font-weight-bold.text-dark.text-uppercase #{subject.name} #{subject.gradeID} - Chỉnh sửa chuyên đề
                                        button.close(type='button', data-dismiss='modal', aria-label='Close')
                                        span(aria-hidden='true') &times;
                                    .modal-body.text-dark
                                        p.card-description Nhập thông tin bên dưới để chỉnh sửa 1 chuyên đề
                                        form.mt-4(action="/units/create", method='post')
                                            .form-group.row
                                                input.form-control(type='text', name='subjectID', hidden)
                                            .form-group.row
                                                label.col-sm-3.col-form-label.text-dark(for='name') Tên chuyên đề
                                                .col-sm-9
                                                    input#name.form-control(type='text', placeholder='Nhập tên chuyên đề', name='name', required)
                                            .float-right
                                                button.btn.btn-secondary(type='button', data-dismiss='modal') Hủy bỏ
                                                button.btn.btn-primary.ml-2(type='submit') Lưu lại
                        
                        #addUnitModal.modal.fade(tabindex='-1', role='dialog', aria-labelledby='addUnitModalLabel', aria-hidden='true')
                            .modal-dialog(role='document', style='transition: all 0.3s ease; max-width: 800px')
                                .modal-content
                                    .modal-header
                                        strong#addUnitModalLabel.modal-title.font-weight-bold.text-dark.text-uppercase #{subject.name} #{subject.gradeID} - Thêm mới chuyên đề
                                        button.close(type='button', data-dismiss='modal', aria-label='Close')
                                        span(aria-hidden='true') &times;
                                    .modal-body.text-dark
                                        p.card-description Nhập thông tin bên dưới để thêm mới 1 chuyên đề
                                        form.mt-4(action="/units/create", method='post')
                                            .form-group.row
                                                input.form-control(type='text', name='subjectID', hidden)
                                            .form-group.row
                                                label.col-sm-3.col-form-label.text-dark(for='name-unit') Tên chuyên đề
                                                .col-sm-9
                                                    input#name-unit.form-control(type='text', placeholder='Nhập tên chuyên đề', name='name', required)
                                            .float-right
                                                button.btn.btn-secondary(type='button', data-dismiss='modal') Hủy bỏ
                                                button.btn.btn-primary.ml-2(type='submit') Lưu lại

                        #addLessionModal.modal.fade(tabindex='-1', role='dialog', aria-labelledby='addLessionModalLabel', aria-hidden='true')
                            .modal-dialog(role='document', style='transition: all 0.3s ease; max-width: 800px')
                                .modal-content
                                    .modal-header
                                        strong#addLessionModalLabel.modal-title.font-weight-bold.text-dark.text-uppercase #{subject.name} #{subject.gradeID} - Thêm mới bài học
                                        button.close(type='button', data-dismiss='modal', aria-label='Close')
                                        span(aria-hidden='true') &times;
                                    .modal-body.text-dark
                                        p.card-description Nhập thông tin bên dưới để thêm mới 1 bài học
                                        form.mt-4(action="/lessions/create", method='post')
                                            .form-group.row
                                                label.col-sm-12.col-form-label.text-dark.label-unit-name.font-weight-bold
                                                input.form-control(type='text', name='unitID', hidden)
                                            .form-group.row
                                                label.col-sm-3.col-form-label.text-dark(for='name-lession') Tên bài học
                                                .col-sm-9
                                                    input#name-lession.form-control(type='text', placeholder='Nhập tên bài học', name='name', required)
                                            .form-group.row
                                                label.col-sm-3.col-form-label.text-dark(for='lessionNumber') Bài học số
                                                .col-sm-9
                                                    input#lessionNumber.form-control(type='number', placeholder='Chọn bài học số', name='lessionNumber', required)
                                            .float-right
                                                button.btn.btn-secondary(type='button', data-dismiss='modal') Hủy bỏ
                                                button.btn.btn-primary.ml-2(type='submit') Lưu lại
    if errors.length > 0
        - var msgError = errors
    else if success.length > 0
        - var msgSuccess = success
    script.
        document.addEventListener('DOMContentLoaded', function() {
            var addLessionModal = $("#addLessionModal");
            var addUnitModal = $("#addUnitModal");
            var unitId, unitName, subjectId;

            addLessionModal.on('show.bs.modal', function (event) {
                var button = $(event.relatedTarget);
                unitId = button.data('id');
                unitName = button.data('name');
                $("#addLessionModal .label-unit-name").text(unitName);
                $("#addLessionModal input[name='unitID']").val(unitId);
            });

            addUnitModal.on('show.bs.modal', function (event) {
                var button = $(event.relatedTarget);
                subjectId = button.data('id');
                $("#addUnitModal input[name='subjectID']").val(subjectId);
            });

            // toast message
            let msgToastError = '#{msgError}';
            if(msgToastError != ''){
                Eggy({
                    title: 'Oops... Có gì đó không đúng',
                    message:  msgToastError,
                    type: 'warning',
                    duration: 5000,
                });
            }

            let msgToastSuccess = '#{msgSuccess}';
            if(msgToastSuccess != ''){
                Eggy({
                    title: 'Thành công',
                    message:  msgToastSuccess,
                    type: 'success',
                    duration: 5000,
                });
            }
        }); 